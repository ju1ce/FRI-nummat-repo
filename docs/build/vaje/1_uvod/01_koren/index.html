<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Računanje kvadratnega korena · Numerična matematika na FRI</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">Numerična matematika na FRI</span></div><form class="docs-search" action="../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../">Domov</a></li><li><span class="tocitem">Uvod</span><ul><li class="is-active"><a class="tocitem" href>Računanje kvadratnega korena</a><ul class="internal"><li><a class="tocitem" href="#Naloga"><span>Naloga</span></a></li><li><a class="tocitem" href="#Računajne-kvadratnega-korena-z-babilonskim-obrazcem"><span>Računajne kvadratnega korena z babilonskim obrazcem</span></a></li><li><a class="tocitem" href="#Hitro-računanje-obratne-vrednosti-kvadratnega-korena"><span>Hitro računanje obratne vrednosti kvadratnega korena</span></a></li></ul></li><li><a class="tocitem" href="../02_pi/">Računanje števila <span>$\pi$</span></a></li></ul></li><li><span class="tocitem">Linearni sistemi</span><ul><li><a class="tocitem" href="../../2_linearni_sistemi/02_tridiagonalni_sistemi/">Tridiagonalni sistemi</a></li><li><a class="tocitem" href="../../2_linearni_sistemi/03_minimalne_ploskve/">Minimalne ploskve (Laplaceova enačba)</a></li><li><a class="tocitem" href="../../2_linearni_sistemi/04_iteracijske_metode/">Iteracijske metode</a></li><li><a class="tocitem" href="../../2_linearni_sistemi/05_implicitne_ploskve/">Interpolacija z implicitnimi funkcijami</a></li></ul></li><li><span class="tocitem">Lastne vrednosti</span><ul><li><a class="tocitem" href="../../3_lastne_vrednosti/06_konj/">Konj na šahovnici</a></li><li><a class="tocitem" href="../../3_lastne_vrednosti/06_spektralno_grucenje/">Spektralno razvrščanje v gruče</a></li></ul></li><li><span class="tocitem">Nelinearne enačbe</span><ul><li><a class="tocitem" href="../../4_nelinearne_enacbe/01_konvergenca/">Konvergenčna območja iteracijskih metod</a></li><li><a class="tocitem" href="../../4_nelinearne_enacbe/02_razdalja/">Nelinearne enačbe in geometrija</a></li></ul></li><li><span class="tocitem">Interpolacija, aproksimacija</span><ul><li><a class="tocitem" href="../../5_interpolacija/07_zlepki/">Interpolacija z zlepki</a></li><li><a class="tocitem" href="../../6_aproksimacija/co2/">Aproksimacija z linearnim modelom</a></li><li><a class="tocitem" href="../../6_aproksimacija/08_chebfun/">Aproksimacija s polinomi Čebiševa</a></li></ul></li><li><span class="tocitem">Integral</span><ul><li><a class="tocitem" href="../../7_integral/10_quad/">Integrali</a></li><li><a class="tocitem" href="../../7_integral/11_quadnD/">Večrazsežni integrali</a></li></ul></li><li><span class="tocitem">Odvod</span><ul><li><a class="tocitem" href="../../8_odvod/12_autodiff/">Automatsko odvajanje</a></li></ul></li><li><span class="tocitem">Diferencialne enačbe</span><ul><li><a class="tocitem" href="../../9_nde/13_lotka_volterra/">Populacijska dinamika</a></li><li><a class="tocitem" href="../../9_nde/14_perioda/">Perioda geostacionarne orbite</a></li></ul></li><li><span class="tocitem">Domače naloge</span><ul><li><a class="tocitem" href="../../../domace/1_domaca/">1. domača naloga</a></li><li><a class="tocitem" href="../../../domace/2_domaca/">2. domača naloga</a></li><li><a class="tocitem" href="../../../domace/3_domaca/">3. domača naloga</a></li><li><a class="tocitem" href="../../../domace/4_domaca/">4. domača naloga</a></li><li><a class="tocitem" href="../../../contributing/">Kako sodelovati pri predmetu Numerična matematika</a></li><li><a class="tocitem" href="../../../workflow/">Developer documentation</a></li></ul></li><li><span class="tocitem">Knjižnica</span><ul><li><a class="tocitem" href="../../../lib/public/">Vidne funkcije</a></li><li><a class="tocitem" href="../../../lib/internals/">Skrite funkcije</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Uvod</a></li><li class="is-active"><a href>Računanje kvadratnega korena</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Računanje kvadratnega korena</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://gitlab.com/nummat/vaje-nummat/blob/master/docs/src/vaje/1_uvod/01_koren.md#" title="Edit on GitLab"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitLab</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Računanje-kvadratnega-korena"><a class="docs-heading-anchor" href="#Računanje-kvadratnega-korena">Računanje kvadratnega korena</a><a id="Računanje-kvadratnega-korena-1"></a><a class="docs-heading-anchor-permalink" href="#Računanje-kvadratnega-korena" title="Permalink"></a></h1><p>Računalniški procesorji navadno implementirajo le osnovne številske operacije: seštevanje, množenje in deljenje. Za računanje drugih matematičnih funkcij  mora nekdo napisati program.</p><div class="admonition is-info"><header class="admonition-header">Elementarne funkcije so v stadardni knjižnici večine jezikov</header><div class="admonition-body"><p>Večina programskih jezikov vsebuje elementarne funkcije v standardni   knjižnici. Tako tudi <code>julia</code>. Lokacijo metod, ki računajo kvadratni koren   lahko dobite z ukazom <code>methods(sqrt)</code>.</p></div></div><h2 id="Naloga"><a class="docs-heading-anchor" href="#Naloga">Naloga</a><a id="Naloga-1"></a><a class="docs-heading-anchor-permalink" href="#Naloga" title="Permalink"></a></h2><p>Napiši funkcijo <code>y = koren(x)</code>, ki bo izračunala približek za kvadratni koren števila <code>x</code>. Poskrbi, da bo rezultat pravilen na 10 decimalnih mest in da bo časovna zahtevnost neodvisna od argumenta <code>x</code>. </p><h2 id="Računajne-kvadratnega-korena-z-babilonskim-obrazcem"><a class="docs-heading-anchor" href="#Računajne-kvadratnega-korena-z-babilonskim-obrazcem">Računajne kvadratnega korena z babilonskim obrazcem</a><a id="Računajne-kvadratnega-korena-z-babilonskim-obrazcem-1"></a><a class="docs-heading-anchor-permalink" href="#Računajne-kvadratnega-korena-z-babilonskim-obrazcem" title="Permalink"></a></h2><p>Z računajnjem kvadratnega korena so se ukvarjali pred 3500 leti v Babilonu. O tem si lahko več preberete v <a href="http://www.presek.si/21/1160-Domajnko.pdf">članku v reviji Presek</a>. Moderna verzija metode računanja približka predstavlja rekurzivno  zaporedje, ki konvergira k vrednosti kvadratnega korena danega števila <span>$x$</span>. Zaporedje približkov lahko izračunamo, tako da uporabimo rekurzivno formulo</p><p class="math-container">\[a_{n+1} = \frac{1}{2}\cdot(a_n + \frac{x}{a_n}).\]</p><p>Če izberemo začetni približek, zgornja formula določa zaporedje, ki vedno konvergira bodisi k <span>$\sqrt{x}$</span> ali <span>$-\sqrt{x}$</span>, odvisno od izbire začetnega približka. Poleg tega, da zaporedje hitro konvergira k limiti, je program, ki računa člene izjemno preprost. Poglejmo si primer kako izračunamo <span>$\sqrt{2}$</span>:</p><pre><code class="language-julia">let
  x = 1.5
  for n = 1:5
    x = (x + 2/x)/2
    println(x)
  end
end</code></pre><pre class="documenter-example-output">1.4166666666666665
1.4142156862745097
1.4142135623746899
1.414213562373095
1.414213562373095</pre><p>Vidimo, da se približki začnejo ponavljati že po 4. koraku. To pomeni, da se zaporedje ne bo več spreminjalo in smo dosegli najboljši približek, kot ga lahko predstavimo z 64 bitnimi števili s plavajočo vejico. </p><p>Napišimo zgornji algoritem še kot funkcijo:</p><pre><code class="language-julia">&quot;&quot;&quot;
    koren_babilonski(x, x0, n)

Izračuna približek za koren števila `x` z `n` koraki babilonskega obrazca z začetnim približkom `x0`.
&quot;&quot;&quot;
function koren_babilonski(x, x0,  n)
    a = x0
    for i = 1:n
        a = (a + x/a)/2
    end
    return a
end</code></pre><pre class="documenter-example-output">Main.ex-koren.koren_babilonski</pre><p>Preskusimo funkcijo na številu 3.</p><pre><code class="language-julia">x  = koren_babilonski(3, 1.7, 5)
println(&quot;Koren števila 3: $x&quot;)
println(&quot;Razlika z vgrajeno funkcijo: $(x-sqrt(3))&quot;)</code></pre><pre class="documenter-example-output">Koren števila 3: 1.7320508075688772
Razlika z vgrajeno funkcijo: 0.0</pre><div class="admonition is-info"><header class="admonition-header">Metoda navadne iteracije in tangentna metoda</header><div class="admonition-body"><p>Metoda računanja kvadratnega korena z babilonskim obrazcem je poseben primer <a href="https://sl.wikipedia.org/wiki/Newtonova_metoda">tangentne metode</a>, ki je poseben primer <a href="https://sl.wikipedia.org/wiki/Metoda_navadne_iteracije">metode fiksne točke</a>. Obe metodi, si bomo podrobneje ogledali, v poglavju o nelinearnih enačbah.</p></div></div><h3 id="Izbira-začetnega-približka"><a class="docs-heading-anchor" href="#Izbira-začetnega-približka">Izbira začetnega približka</a><a id="Izbira-začetnega-približka-1"></a><a class="docs-heading-anchor-permalink" href="#Izbira-začetnega-približka" title="Permalink"></a></h3><p>Funkcija <code>koren_babilonski(x, x0, n)</code> ni uporabna za splošno rabo, saj mora uporabnik poznati tako začetni približek,  kot tudi število korakov, ki so potrebni, da dosežemo željeno natančnost. Da bi lahko funkcijo uporabljal kdor koli, bi morala funkcija sama izbrati začetni približek, kot tudi število korakov.</p><p>Kako bi učinkovito izbrali dober začetni približek? Dokazati je mogoče, da rekurzivno zaporedje konvergira ne glede na izbran začetni približek. Tako lahko uporabimo kar samo število <span>$x$</span>. Malce boljši približek dobimo s Taylorjevem razvojem korenske funkcije okrog števila 1</p><p class="math-container">\[\sqrt{x} = 1 + \frac{1}{2}(x-1) + ... \approx 1/2 + x/2.\]</p><p>Število korakov lahko izberemo avtomatsko tako, da računamo nove približke, dokler relativna napaka ne pade pod v naprej predpisano mejo (v našem primeru bomo izbrali napako tako, da bomo dobili približno 10 pravilnih decimalnih mest). Program implementiramo kot novo metodo za funkcijo <code>koren</code></p><pre><code class="language-julia">&quot;&quot;&quot;
    y, st_iteracij = koren_babilonski(x, x0)

Izračunaj vrednost kvadratnega korena danega števila `x` z babilonskim obrazcem z začetnim približkom `x0`. Funkcija vrne
vrednost približka za kvadratni koren in število iteracij (kolikokrat zaporedoma smo uporabili babilonski obrazec, da smo dobili zahtevano natančnost).
&quot;&quot;&quot;
function koren_babilonski(x, x0)
    a = x0
    it = 0
    while abs(a^2 - x) &gt; abs(x)*0.5e-11
        a = (a + x/a)/2
        it += 1
    end
    return a, it
end

y, it = koren_babilonski(10, 0.5 + 10/2)
println(&quot;Za izračun korena števila 10, potrebujemo $it korakov.&quot;)
y, it = koren_babilonski(1000, 0.5 + 1000/2)
println(&quot;Za izračun korena števila 1000, potrebujemo $it korakov.&quot;)</code></pre><pre class="documenter-example-output">Za izračun korena števila 10, potrebujemo 5 korakov.
Za izračun korena števila 1000, potrebujemo 8 korakov.</pre><p>Opazimo, da za večje število, potrebujemo več korakov. Poglejmo si, kako se število korakov spreminja, v odvisnosti od števila <code>x</code>.</p><pre><code class="language-julia">using Plots
plot(x -&gt; koren_babilonski(x, 0.5 + x/2)[2], 0.0001, 10000, xaxis=:log10, minorticks = true, formatter=identity, label=&quot;število korakov&quot;)
savefig(&quot;koren_stevilo_korakov.png&quot;)</code></pre><p><img src="../koren_stevilo_korakov.png" alt="Število korakov v odvisnosti od argumenta"/></p><p>Začetni približek <span>$1/2 + x/2$</span> dobro deluje za števila blizu 1, če isto formulo za začetni približek preskusimo za večja števila, dobimo večjo relativno napako. Oziroma potrebujemo več korakov zanke, da pridemo do enake natančnosti. Razlog je v tem, da je <span>$\frac{1}{2} + \frac{x}{2}$</span> dober približek za majhna števila, če pa se od števila 1 oddaljimo, je približek slabši, bolj kot smo oddaljeni od 1:</p><pre><code class="language-julia">using Plots
plot(x -&gt; 0.5 + x/2, 0, 10, label=&quot;začetni približek&quot;)
plot!(x -&gt; sqrt(x), 0, 10, label=&quot;korenska funkcija&quot;)
savefig(&quot;koren_zacetni_priblizek.png&quot;)</code></pre><p><img src="../koren_zacetni_priblizek.png" alt="začetni približek v primerjavi z dejansko vrednostjo korena"/></p><p>Da bi dobili boljši približek, si pomagamo s tem, kako so števila predstavljena v računalniku. Realna števila predstavimo s števili s <a href="https://sl.wikipedia.org/wiki/Plavajo%C4%8Da_vejica">plavajočo vejico</a>. Število je zapisano v obliki</p><p class="math-container">\[ x = m 2^e\]</p><p>kjer je <span>$0.5\le m&lt;1$</span> mantisa, <span>$e$</span> pa eksponent. Za 64 bitna števila s plavajočo vejico se za zapis mantise uporabi 53 bitov (52 bitov za decimalke, en bit pa za predznak), 11 bitov pa za eksponent (glej <a href="https://en.wikipedia.org/wiki/IEEE_754">IEE 754 standard</a>).</p><p>Koren števila <span>$x$</span> lahko potem izračunamo kot</p><p class="math-container">\[\sqrt{x} = \sqrt{m} 2^{e/2}\]</p><p>dober začetni približek dobimo tako, da <span>$\sqrt{m}$</span> aproksimiramo razvojem v Taylorjevo vrsto okrog točke 1 </p><p class="math-container">\[\sqrt{m} \approx 1 + \frac{1}{2}(m-1) = 1/2 + m/2\]</p><p>Če eksponent delimo z 2 in zanemarimo ostanek <span>$e = 2d + o$</span>, lahko <span>$\sqrt{2^e}$</span> približno zapišemo kot</p><p class="math-container">\[\sqrt{2^e} \approx 2^d.\]</p><p>Celi del števila pri deljenju z 2 lahko dobimo z binarnim premikom v desno (right shift). Potenco števila <span>$2^n$</span>, pa z binarnim premikom števila 1 v levo za <span>$n$</span> mest. Tako lahko zapišemo naslednjo funckijo za začetni približek:</p><pre><code class="language-julia">&quot;&quot;&quot;
    zacetni_priblizek(x)

Izračunaj začetni približek za tangentno metodo za računanje kvadratnega korena števila `x`.
&quot;&quot;&quot;
function zacetni_priblizek(x)
  d = exponent(x) &gt;&gt; 1 # desni premik oziroma deljenje z 2
  m = significand(x)
  if d &lt; 0
    return (0.5 + 0.5*m) / (1 &lt;&lt; -d)
  end
  return (0.5 + 0.5*m) * (1 &lt;&lt; d)
end</code></pre><pre class="documenter-example-output">Main.ex-koren.zacetni_priblizek</pre><p>Primrjajmo izboljšano verzijo začetnega približka s pravo korensko funkcijo:</p><pre><code class="language-julia">using Plots
plot(zacetni_priblizek, 0, 1000, label=&quot;začetni približek&quot;)
plot!(sqrt, 0, 1000, label=&quot;kvadratni koren&quot;)
savefig(&quot;koren_izboljsan_zp.png&quot;)</code></pre><p><img src="../koren_izboljsan_zp.png" alt="Izboljšan začetni približek"/></p><p>Oglejmo si sedaj število korakov, če uporabimo izboljšani začetni približek.</p><pre><code class="language-julia">using Plots
plot(x -&gt; koren_babilonski(x, zacetni_priblizek(x))[2], 0.0001, 10000, xaxis=:log10, minorticks = true, formatter=identity, label=&quot;število korakov&quot;)
savefig(&quot;koren_stevilo_korakov_izp.png&quot;)</code></pre><p><img src="../koren_stevilo_korakov_izp.png" alt="Število korakov v odvisnosti od argumenta za izboljšan začetni približek"/></p><p>Opazimo, da se število korakov ne spreminja več z naraščanjem argumenta, to pomeni, da bo časovna zahtevnost tako implemetirane korenske funkcije konstantna in neodvisna od izbire argumenta.</p><pre><code class="language-julia">using Plots
rel_napaka(x) = (koren_babilonski(x, 0.5 + x/2, 4)^2 - x)/x
plot(rel_napaka, 0.5, 2)
savefig(&quot;napaka_koren_babilonski.png&quot;)</code></pre><p><img src="../napaka_koren_babilonski.png" alt="Relativna napaka na [0.5, 2]"/></p><p>Sedaj lahko sestavimo funkcijo za računanje korena, ki potrebuje le število in ima konstantno časovno zahtevnost</p><pre><code class="language-julia">&quot;&quot;&quot;
    y = koren(x)

Izračunaj kvadratni koren danega števila `x` z babilonskim obrazcem.
&quot;&quot;&quot;
function koren(x)
    y = zacetni_priblizek(x)
    for i = 1:4
        y = (y + x / y)/2
    end
    return y
end</code></pre><pre class="documenter-example-output">Main.ex-koren.koren</pre><p>Preverimo, da je relativna napaka neodvisna od izbranega števila, prav tako pa za izračun potrebujemo enako število operacij.</p><pre><code class="language-julia">plot(x -&gt; (koren(x)^2 - x)/x, 0.001, 1000.0, xaxis=:log, minorticks = true, formatter=identity, label=&quot;relativna napaka&quot;)
savefig(&quot;koren_relativna_napaka.png&quot;)</code></pre><p><img src="../koren_relativna_napaka.png" alt="Relativna napaka korenske funkcije"/></p><h2 id="Hitro-računanje-obratne-vrednosti-kvadratnega-korena"><a class="docs-heading-anchor" href="#Hitro-računanje-obratne-vrednosti-kvadratnega-korena">Hitro računanje obratne vrednosti kvadratnega korena</a><a id="Hitro-računanje-obratne-vrednosti-kvadratnega-korena-1"></a><a class="docs-heading-anchor-permalink" href="#Hitro-računanje-obratne-vrednosti-kvadratnega-korena" title="Permalink"></a></h2><p>Pri razvoju računalniških iger, ki poskušajo verno prikazati 3 dimenzionalni svet na zaslonu, se veliko uporablja normiranje  vektorjev. Pri operaciji normiranja je potrebno komponente vektorja deliti s korenom vsote kvadratov komponent. Kot smo  spoznali pri računanju kvadratnega korena z babilonskim obrazcem, je posebej problematično poiskati ustrezen začetni približek, ki je dovolj blizu pravi rešitvi. Tega problema so se zavedali tudi inžinirji igre Quake, ki so razvili posebej  zvit, skoraj magičen način za dober začetni približek. Metoda uporabi posebno vrednost <code>0x5f3759df</code>, da pride do začetnega  približka, nato pa še en korak <a href="ttps://sl.wikipedia.org/wiki/Newtonova_metoda">tangentne metode</a>. Več o <a href="https://en.wikipedia.org/wiki/Fast_inverse_square_root">računanju obratne vrednosti kvadratnega korena</a>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../../">« Domov</a><a class="docs-footer-nextpage" href="../02_pi/">Računanje števila <span>$\pi$</span> »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Wednesday 23 February 2022 23:51">Wednesday 23 February 2022</span>. Using Julia version 1.7.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
